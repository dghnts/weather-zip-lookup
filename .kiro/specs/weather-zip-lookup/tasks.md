# 実装計画: weather-zip-lookup

## 概要

郵便番号から天気情報を取得するクロスプラットフォーム対応のPythonターミナルスクリプトを実装します。OpenWeatherMap APIを使用して、現在の気温、降水確率、気象警報を取得し、色付きでフォーマットされた出力を提供します。

## タスク

- [x] 1. プロジェクト構造とコアインターフェースのセットアップ
  - プロジェクトディレクトリ構造を作成
  - データモデル（`WeatherData`、`WeatherAlert`）を定義
  - カスタム例外クラスを定義
  - テストフレームワーク（pytest、Hypothesis）をセットアップ
  - 依存関係（requests、colorama）を`requirements.txt`に追加
  - _要件: 1.1, 1.2, 8.1_

- [x] 2. 設定管理機能の実装
  - [x] 2.1 `ConfigManager`クラスを実装
    - プラットフォーム固有の設定ファイルパスを取得する機能
    - 設定ファイルの読み書き機能（JSON形式）
    - デフォルト郵便番号とAPIキーの取得機能
    - _要件: 3.1, 3.2, 3.4, 3.5, 6.2_
  
  - [x] 2.2 設定ファイルのラウンドトリッププロパティテストを作成
    - **プロパティ7: 設定ファイルのラウンドトリップ**
    - **検証: 要件 3.2, 3.5, 6.2**
  
  - [x] 2.3 プラットフォーム固有のパス生成プロパティテストを作成
    - **プロパティ9: プラットフォーム固有のパス生成**
    - **検証: 要件 3.4, 4.4**
  
  - [x] 2.4 設定ファイルエラー処理のプロパティテストを作成
    - **プロパティ8: 設定ファイルエラーの処理**
    - **検証: 要件 3.3, 7.4**
  
  - [ ]* 2.5 設定管理のユニットテストを作成
    - 初回実行時の設定ファイル作成をテスト
    - 破損した設定ファイルの処理をテスト
    - _要件: 3.1, 3.3_

- [x] 3. チェックポイント - すべてのテストが成功することを確認
  - すべてのテストが成功することを確認し、質問があればユーザーに尋ねてください。

- [ ] 4. 天気サービスレイヤーの実装
  - [x] 4.1 `WeatherService`クラスを実装
    - 郵便番号を緯度経度に変換する機能（Geocoding API）
    - 現在の天気データを取得する機能（Current Weather API）
    - 気象警報を取得する機能（One Call API）
    - APIエラーハンドリング（401、404、429、500-599）
    - _要件: 1.1, 1.2, 1.3, 1.4, 6.1, 6.4, 8.1_
  
  - [ ]* 4.2 天気データ取得の完全性プロパティテストを作成
    - **プロパティ1: 天気データ取得の完全性**
    - **検証: 要件 1.1, 1.2**
  
  - [ ]* 4.3 APIレスポンス解析の正確性プロパティテストを作成
    - **プロパティ2: APIレスポンス解析の正確性**
    - **検証: 要件 1.3**
  
  - [ ]* 4.4 気象警報の完全な取得プロパティテストを作成
    - **プロパティ14: 気象警報の完全な取得**
    - **検証: 要件 8.1**
  
  - [ ]* 4.5 APIリクエストへのキー含有プロパティテストを作成
    - **プロパティ13: APIリクエストへのキー含有**
    - **検証: 要件 6.4**
  
  - [ ]* 4.6 天気サービスのユニットテストを作成
    - モックAPIレスポンスを使用した統合テスト
    - 郵便番号が見つからない場合のテスト（404エラー）
    - APIレート制限のテスト（429エラー）
    - _要件: 1.4, 6.5, 7.3_

- [ ] 5. 入力検証とエラーハンドリングの実装
  - [x] 5.1 郵便番号検証機能を実装
    - 7桁の数字形式を検証
    - 無効な形式に対するエラーメッセージ
    - _要件: 1.5, 2.3_
  
  - [ ]* 5.2 入力検証プロパティテストを作成
    - **プロパティ4: 入力検証**
    - **検証: 要件 1.5**
  
  - [ ]* 5.3 郵便番号形式の受け入れプロパティテストを作成
    - **プロパティ6: 郵便番号形式の受け入れ**
    - **検証: 要件 2.3**
  
  - [ ]* 5.4 エラー条件の適切な処理プロパティテストを作成
    - **プロパティ3: エラー条件の適切な処理**
    - **検証: 要件 1.4, 7.1, 7.2, 7.5**
  
  - [ ]* 5.5 エラーハンドリングのユニットテストを作成
    - ネットワークエラーのテスト
    - 各エラータイプの終了コードをテスト
    - _要件: 7.1, 7.2, 7.5_

- [x] 6. チェックポイント - すべてのテストが成功することを確認
  - すべてのテストが成功することを確認し、質問があればユーザーに尋ねてください。

- [ ] 7. 出力フォーマッターの実装
  - [x] 7.1 `OutputFormatter`クラスを実装
    - 天気データのフォーマット機能
    - 気温の色分け（青/緑/赤）
    - 降水確率の色分け（灰色/黄色/赤）
    - 気象警報の視覚的強調（赤背景、アイコン）
    - coloramaを使用したクロスプラットフォーム対応
    - _要件: 5.1, 5.2, 5.3, 5.4, 8.2, 8.3, 8.4_
  
  - [ ]* 7.2 出力の完全性プロパティテストを作成
    - **プロパティ11: 出力の完全性**
    - **検証: 要件 5.2, 5.3, 5.4**
  
  - [ ]* 7.3 色付き出力の生成プロパティテストを作成
    - **プロパティ12: 色付き出力の生成**
    - **検証: 要件 5.1**
  
  - [ ]* 7.4 警報情報の表示プロパティテストを作成
    - **プロパティ15: 警報情報の表示**
    - **検証: 要件 8.2, 8.3**
  
  - [ ]* 7.5 警報の視覚的強調プロパティテストを作成
    - **プロパティ16: 警報の視覚的強調**
    - **検証: 要件 8.4**
  
  - [ ]* 7.6 文字エンコーディングの一貫性プロパティテストを作成
    - **プロパティ10: 文字エンコーディングの一貫性**
    - **検証: 要件 4.5**
  
  - [ ]* 7.7 出力フォーマッターのユニットテストを作成
    - 警報がない場合の出力をテスト
    - 極端な気温値のフォーマットをテスト
    - _要件: 8.5_

- [ ] 8. CLIインターフェースの実装
  - [x] 8.1 コマンドライン引数解析を実装
    - 郵便番号引数のサポート
    - ヘルプフラグ（-h、--help）のサポート
    - _要件: 2.1, 2.2, 2.4_
  
  - [x] 8.2 メインフロー制御を実装
    - 引数または設定ファイルから郵便番号を取得
    - 設定ファイルとAPIキーの初期化
    - 天気サービスの呼び出し
    - 出力フォーマッターの呼び出し
    - エラーハンドリングと終了コード
    - _要件: 2.1, 2.2, 3.3, 6.3, 7.5_
  
  - [ ]* 8.3 コマンドライン引数の優先プロパティテストを作成
    - **プロパティ5: コマンドライン引数の優先**
    - **検証: 要件 2.1**
  
  - [ ]* 8.4 CLIのユニットテストを作成
    - 引数なしでの実行（デフォルト郵便番号使用）をテスト
    - ヘルプフラグの表示をテスト
    - APIキー欠落時のプロンプトをテスト
    - _要件: 2.2, 2.4, 6.3_

- [ ] 9. 統合とエントリーポイントの作成
  - [x] 9.1 すべてのコンポーネントを統合
    - メインスクリプト（`weather.py`）を作成
    - 実行可能スクリプトとしてセットアップ（shebang、chmod）
    - _要件: すべて_
  
  - [ ]* 9.2 エンドツーエンド統合テストを作成
    - 実際のAPIを使用した統合テスト（オプション、環境変数でスキップ可能）
    - モックAPIを使用した完全なフローテスト
    - _要件: すべて_

- [x] 10. 最終チェックポイント - すべてのテストが成功することを確認
  - すべてのテストが成功することを確認し、質問があればユーザーに尋ねてください。

## 注意事項

- `*`でマークされたタスクはオプションであり、より速いMVPのためにスキップできます
- 各タスクは特定の要件を参照してトレーサビリティを確保します
- チェックポイントは段階的な検証を保証します
- プロパティテストは普遍的な正確性プロパティを検証します
- ユニットテストは特定の例とエッジケースを検証します
